{% extends "base.html" %}
{% block content %}
<h1>Manage Servers</h1>

<button id="reload-button" type="button" class="btn btn-default">Reload</button></br>

<table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th class="hidden-xs">Instance ID</th>
      <th>Label</th>
      <th>State</th>
      <th class="hidden-xs">IP</th>
      <th>Info</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for instance in instances %}
    <tr {% if instance.highlight %}class="info"{% endif %}>
      <td class="hidden-xs">{{ instance.iid }}</td>
      <td>{{ instance.label }}</td>
      <td>{{ instance.state }}</td>
      <td class="hidden-xs">{{ instance.ip }} </td>
      <td>
        {% if instance.uptime %}
        <p>Uptime: {{ instance.uptime[0] }} hour(s) and {{ instance.uptime[1] }} minute(s)</p>
        {% endif %}
        <p class="visible-xs">IID: {{ instance.iid }}</p>
        <p class="visible-xs">IP: {{ instance.ip }}</p>
      </td>
      <td>
        {% for action in instance.actions %}
        <button id="{{instance.iid}}.{{action}}" type="button" class="btn btn-default action-button">{{action}}</button>
        {% endfor %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
{% block after_scripts %}
<script>
  $(".action-button").click(function (event){
    data = event.currentTarget.id.split('.');
    $('<form action="/manage/' + data[0] + '" method="POST">' +
      '<input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />' +
      '<input type="hidden" name="action" value="' + data[1] + '">' + 
      '</form>').submit();
  });
  $("#reload-button").click(function (event){
    window.location.href = "{{ url_for('manage', update=True) }}";
  });
</script>
{% endblock %}
